<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-X3ZSVPDNBQ"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'G-X3ZSVPDNBQ');
        </script>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Two-Qubit System</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1">
        <link rel="stylesheet" href="../css/common.css">
        <link rel="stylesheet" href="../css/600-cell.css">
        <link rel="stylesheet" href="../css/2-qubit-system.css">
        <link rel="stylesheet" href="../css/scoreboard.css">
        <link rel="stylesheet" href="../css/windowManager.css">
    </head>
    <body>
        <noscript></noscript>
        <header>
            <h1>Quantum Games, Tricks, and Patterns</h1>
            <a href = "../index.html">Introduction</a> | <a href="peres-1.html">Peres-1</a> | <a href="peres-2.html">Peres-2</a> | <a href="PMSquare.html">Peres-Mermin Square</a> | <a href="GHZ.html">GHZ-Mermin Pentagram</a> | <a href="600-cell.html">600-cell</a>  | <a href="2-qubit-system.html">Two-qubit System </a> | <a href="../credits.html">Credits</a>
        </header>
        <div id="content">
            <br style="margin-bottom:10px;">
            <h1 class="gameHeader">The two-qubit system</h1>
            <div id="upperArea">
                <div id="upperLeft">
                    <div class="leftArea">
                        <h3>Menu</h3>
                        <button onClick="OpenWindow({url:'about/2-qubit-system.html'})">The Demonstration</button><br>
                        <button onClick="OpenWindow({url:'notes/2-qubit-system.html', width:500, height:350})">Notes</button>
                    </div>
                    <div class="leftArea">
                        <h3>Actions</h3>
                        <button class="resetButton" onClick="{document.querySelectorAll('.solveButton option')[0].selected = true; reset();}">Reset</button>
                        <br>
                        <label>Display a solution:</label><br>
                        <select name="solveButton" class="solveButton" onchange = "solve(this.value)">
                            <option class="solution" value="-" selected>-</option>
                            <!-- options omitted for brevity -->
                            <option class="solution" value="60-41">60-41</option>
                        </select>
                    </div>

                    <div id="score" class="moveCounter even">
                        Basis Counter: 
                        <div id="numBasis" class="inner">0</div>
                        <button id="parityProofsButton" class="resetButton off" style="margin-top:10px;">All parity proofs</button>
                    </div>
                </div>
                <div id="game">
                    <table id="boardContainer"></table>
                    <table id="scoreboard"></table>
                </div>
            </div>
        </div>
        <script src="windowManager.js"></script>
        <script src="tablegen.js"></script>
        <script src="2-qubit-system.js"></script>
        <script>
        // Overlay logic for All parity proofs button
        document.addEventListener('DOMContentLoaded', function() {
            var btn = document.getElementById('parityProofsButton');
            if (!btn) return;

            // helper: key for localStorage
            var STORAGE_KEY = 'paritySequence_v1';

            btn.onclick = function() {
                var old = document.getElementById('parityProofsOverlay');
                if (old) {
                    old.remove();
                    return;
                }
                // Create overlay
                var overlay = document.createElement('div');
                overlay.id = 'parityProofsOverlay';
                overlay.style.position = 'absolute';
                overlay.style.background = 'white';
                overlay.style.border = '2px solid #888';
                overlay.style.boxShadow = '0 2px 12px rgba(0,0,0,0.2)';
                overlay.style.zIndex = '1000';
                overlay.style.padding = '24px 32px';
                overlay.style.top = (btn.getBoundingClientRect().bottom + window.scrollY + 10) + 'px';
                overlay.style.left = (document.getElementById('game').getBoundingClientRect().left + window.scrollX) + 'px';
                overlay.style.width = 'calc(98vw - ' + overlay.style.left + ')';
                overlay.style.maxWidth = '98vw';
                overlay.style.minWidth = '800px';
                overlay.style.fontSize = '1.1em';
                overlay.innerHTML = `
                    <div style="display:flex;justify-content:space-between;align-items:center;">
                        <b>All parity proofs</b>
                        <button id="parityCloseBtn" class="resetButton power off">Close</button>
                    </div>
                    <div id="parityProofsContent" style="margin-top:12px;">
                        <div id="parityNumberDisplay" style="font-size:1.25em;font-weight:600;text-align:center;width:100%;margin-bottom:8px;position:relative;z-index:1101;padding:6px 10px;background:white;border-radius:6px;display:inline-block;">0</div>
                            <div id="paritySliders" style="margin-top:14px;display:flex;flex-direction:column;gap:6px;overflow:visible;">
                                <div id="parityTop" style="display:flex;gap:8px;overflow:visible;padding-bottom:10px;align-items:flex-end;height:200px;"></div>
                                    <div id="parityBottom" style="display:flex;gap:8px;overflow:visible;padding-top:10px;align-items:flex-end;height:200px;"></div>
                        </div>
                        <div style="margin-top:12px;display:flex;justify-content:space-between;align-items:center;">
                            <button id="parityResetButton" class="resetButton">Reset sliders</button>
                            <button id="paritySetButton" class="resetButton power on">Set</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(overlay);

                // Initialize the 19 sliders (9 top, 10 bottom) and wire up handlers
                (function initParitySliders(container){
                    var top = container.querySelector('#parityTop');
                    var bottom = container.querySelector('#parityBottom');

                    function makeSlider(pos, initialValue){
                        var wrap = document.createElement('div');
                        wrap.style.display = 'flex';
                        wrap.style.flexDirection = 'column';
                        wrap.style.alignItems = 'center';
                        wrap.style.minWidth = '44px';
                        wrap.style.height = '180px';
                        wrap.style.paddingTop = '24px';
                        wrap.style.boxSizing = 'border-box';

                        var input = document.createElement('input');
                        input.type = 'range';
                        input.min = '0';
                        input.max = '9';
                        input.step = '1';
                        input.value = String(initialValue || 0);
                        input.className = 'parity-slider';
                        input.dataset.pos = pos;
                        // Make the slider vertical by rotating it and giving it a length; ensure room so it isn't clipped
                        input.style.width = '120px';
                        input.style.height = '16px';
                        input.style.transform = 'rotate(-90deg)';
                        input.style.transformOrigin = '50% 50%';
                        input.style.margin = '0 0 4px 0';
                        input.style.display = 'block';

                        var valSpan = document.createElement('div');
                        valSpan.textContent = String(input.value);
                        valSpan.style.marginTop = '4px';
                        valSpan.style.fontFamily = 'monospace';
                        valSpan.style.textAlign = 'center';

                        input.addEventListener('input', function(){
                            // update the adjacent label
                            if (input.nextElementSibling) input.nextElementSibling.textContent = this.value;
                            updateDisplay();
                        });

                        // order: slider then value label
                        wrap.appendChild(input);
                        wrap.appendChild(valSpan);
                        return wrap;
                    }

                    // load saved sequence (if any) from localStorage
                    var saved = null;
                    try {
                        saved = localStorage.getItem(STORAGE_KEY);
                        if (saved && saved.length !== 19) saved = null;
                    } catch (e) {
                        saved = null;
                    }

                    for(var i=0;i<9;i++){
                        var val = saved ? parseInt(saved.charAt(i), 10) : 0;
                        top.appendChild(makeSlider(i, val));
                    }
                    for(var i=9;i<19;i++){
                        var val = saved ? parseInt(saved.charAt(i), 10) : 0;
                        bottom.appendChild(makeSlider(i, val));
                    }

                    function updateDisplay(){
                        var sliders = container.querySelectorAll('.parity-slider');
                        var vals = Array.prototype.slice.call(sliders).sort(function(a,b){
                            return parseInt(a.dataset.pos) - parseInt(b.dataset.pos);
                        }).map(function(s){ return String(parseInt(s.value)); });
                        var combined = vals.join('');
                        container.querySelector('#parityNumberDisplay').textContent = combined;
                        // TODO figure out how to have it make smaller if it is too big.
                        return combined;
                    }

                    container.querySelector('#parityResetButton').addEventListener('click', function(){
                        var sliders = container.querySelectorAll('.parity-slider');
                        sliders.forEach(function(s){
                            s.value = '0';
                            // update the visible label next to the slider reliably
                            if (s.nextElementSibling) s.nextElementSibling.textContent = '0';
                        });
                        updateDisplay();
                    });

                    // Close: save current sequence and remove overlay
                    var closeBtn = container.querySelector('#parityCloseBtn');
                    if (closeBtn) closeBtn.addEventListener('click', function(){
                        var seq = updateDisplay();
                        try { localStorage.setItem(STORAGE_KEY, seq); } catch (e) { /* ignore storage errors */ }
                        container.remove();
                    });

                    // Set: also save the current sequence (and optionally trigger any global handler)
                    var setBtn = container.querySelector('#paritySetButton');
                    if (setBtn) setBtn.addEventListener('click', function(){
                        var seq = updateDisplay();
                        try { localStorage.setItem(STORAGE_KEY, seq); } catch (e) {}
                        // If you have a function to apply the parity sequence globally, call it here:
                        if (typeof applyParitySequence === 'function') {
                            try { applyParitySequence(seq); } catch (e) { console.warn('applyParitySequence failed', e); }
                        }
                    });

                    // initial update
                    updateDisplay();
                })(overlay);
            };
        });
        </script>
    </body>
</html>
